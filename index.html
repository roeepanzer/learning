<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Grow tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="headline">
    <h1>Firebase Realtime Database</h1>
    <div id="notification">This is a notification</div>
  </div>
<!--   <a href="https://roeepanzer.github.io/learning/clock.html">link to my live clock</a> -->
  <div id="clockArea">The current time: <div id="clock">Loading...</div></div>
    <script>
      function updateClock() {
        const now = new Date();
  
        // Format HH:MM:SS
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
  
        // Format DD.MM.YYYY
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const year = now.getFullYear();
  
        const timeString = `${hours}:${minutes}:${seconds}`;
        const dateString = `${day}.${month}.${year}`;
  
        document.getElementById('clock').textContent = `${dateString}   ${timeString}`;
      }
      // Update immediately, then every second
      updateClock();
      setInterval(updateClock, 1000);
    </script>
  
  <div class="gauges">
    <section class="gauge" data-type="light">
      <div class="gauge__title">Light</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="lightView">NoLight</div>
        <div class="gauge__unit">lux</div>
      </div>
    </section>
  
    <section class="gauge" data-type="temp">
      <div class="gauge__title">Temperature</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="tempView">NoTemp</div>
        <div class="gauge__unit">&deg;C</div>
      </div>
    </section>
  
    <section class="gauge" data-type="hum">
      <div class="gauge__title">humidity</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="humidView">noHumid</div>
        <div class="gauge__unit">%</div>
      </div>
    </section>

    <section class="gauge" data-type="wind">
      <div class="gauge__title">Wind</div>
      <div class="gauge__dial">
        <div class="gauge__value" id="windView">noWind</div>
        <div class="gauge__unit">km/h</div>
      </div>
    </section>
  </div>
<!--   <h3>Logs</h3> -->
<!--   <pre id="log"></pre> -->
  <div id="weather">
    <h2>Current weather</h2>
    <div id="liveWeather">
      <p>data at 1, ID: </p><p id="name">n</p>
      <p>age: </p><p id="age">n</p>
      <p>city: </p><p id="city">n</p>
      <p>Temperature: </p><p id="tempAPI"></p><p>&deg;C</p>
      <p>Relative Humidity: </p><p id="humidAPI"></p><p>%</p>
      <p>Precipitations: </p><p id="precipAPI"></p><p>mm</p>
      <p>Wind Speed: </p><p id="windSpAPI"></p><p>km/h</p>
      <p>Wind Gusts: </p><p id="windGuAPI"></p><p>km/h</p>
      <p>Wind direction: </p><p id="windDiAPI"></p><p>&deg;</p>
    </div>
    <script>
      const url = "https://dogapi.dog/api/v2/breeds";
      //const url = "https://api.open-meteo.com/v1/forecast?latitude=51.793181954585414&longitude=6.159587746646279&hourly=wind_speed_80m,wind_direction_10m,wind_direction_80m,wind_gusts_10m,wind_speed_10m,cloud_cover,precipitation_probability,precipitation&current=wind_speed_10m,wind_direction_10m,wind_gusts_10m,temperature_2m,relative_humidity_2m,precipitation&minutely_15=wind_gusts_10m,precipitation,wind_speed_10m&timezone=Europe%2FBerlin&forecast_days=3";
      let jsonResult = getWeather(url);
      // document.getElementById("tempAPI").innerHTML = getValue(jsonResult, "tempAPI");
      // document.getElementById("humidAPI").innerHTML = getValue(jsonResult, "humidAPI");
      // document.getElementById("precipAPI").innerHTML = getValue(jsonResult, "precipAPI");
      // document.getElementById("windSpAPI").innerHTML = getValue(jsonResult, "windSpAPI");
      // document.getElementById("windGuAPI").innerHTML = getValue(jsonResult, "windGuAPI");
      // document.getElementById("windDiAPI").innerHTML = getValue(jsonResult, "windDiAPI");
      
      // document.getElementById("name").innerHTML = getValue(jsonResult, "name");
      document.getElementById("name").innerHTML = jsonResult.data[1];
      // document.getElementById("age").innerHTML = getValue(jsonResult, "age");
      document.getElementById("age").innerHTML = jsonResult.links;
      // document.getElementById("city").innerHTML = getValue(jsonResult, "city");
      document.getElementById("city").innerHTML = jsonResult.links["current"];
      
      async function getWeather(url) {
        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`Response status: ${response.status}`);
          }
          const result = await response.json();
          return result;
        } 
        catch (error) {
          console.error(error.message);
        }
      }

      async function getValue(jsonResult, valueID) {
        switch(valueID) {
          case "tempAPI":
            return jsonResult.current.temperature_2m;
            break;
          case "humidAPI":
            return jsonResult.current.relative_humidity_2m;
            break;
          case "precipAPI":
            return jsonResult.current.precipitation;
            break;
          case "windSpAPI":
            return jsonResult.current.wind_speed_10m;
            break;
          case "windGuAPI":
            return jsonResult.current.wind_gusts_10m;
            break;
          case "windDiAPI":
            return jsonResult.current.wind_direction_10m;
            break;
          case "name":
            return jsonResult.name;
            break;
          case "age":
            return jsonResult.values.age;
            break;
          case "city":
            return jsonResult.values.city;
            break;
        }
      }
    </script>
    <h2>Weather Forcast</h2>
    <a class="weatherwidget-io" href="https://forecast7.com/en/51d796d13/kleve/" data-label_1="KLEVE" data-label_2="WEATHER" data-icons="Climacons" data-days="3" data-theme="original" >KLEVE WEATHER</a>
  </div>
  <script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
  </script>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
    
    // const log = (...args) => {console.log(...args); document.getElementById('log').textContent += args.join(' ') + '\n'; };
    const lightEl = document.getElementById('lightView');
    const tempEl = document.getElementById('tempView');
    const humidEl = document.getElementById('humidView');

    const firebaseConfig = {
      apiKey: "AIzaSyAVMPlPrVKRvZ6VPdyXHlmxEQjmL1tmges",
      authDomain: "learning-d6e02.firebaseapp.com",
      databaseURL: "https://learning-d6e02-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "learning-d6e02",
      storageBucket: "learning-d6e02.firebasestorage.app",
      messagingSenderId: "119584364745",
      appId: "1:119584364745:web:62fe63a64dddbc8c329518",
      measurementId: "G-85VLDXL87W"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    async function liveHumid() {
      onValue(ref(db, 'liveData/humid'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          humidEl.textContent = value;
        }
      });
    }

    async function liveTemp() {
      onValue(ref(db, 'liveData/temp'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          tempEl.textContent = value;
        }
      });
    }

    async function liveLight() {
      onValue(ref(db, 'liveData/light'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          lightEl.textContent = value;
        }
      });
    }
    
    async function onValueLiveGeneralData() {
      onValue(ref(db, 'test'), (snapshot) => {
        if(snapshot.exists()) {
          const value = snapshot.val();
          log("---------");
          log("General value is: " + value);
          log("int value is: " + value.int);
          log("float value is: " + value.float);
          log("---------");
          GeneralEl.textContent = value;
        }
      });
    }
    
    async function testConn() {
      statusEl.textContent = 'Writing test valueâ€¦';
      set(ref(db, 'test/connection'), {status: "ok", timeStamp: Date.now() });
      log('Write succeeded');
    };
  
    liveLight();
    liveTemp();
    liveHumid();
  </script>
</body>
</html>
